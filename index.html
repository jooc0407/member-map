<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜‘íšŒ íšŒì›ì‚¬ ì§€ë„ ê´€ë¦¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .login-container { min-height: 100vh; background: linear-gradient(135deg, #e0f2fe 0%, #bfdbfe 100%); display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-box { background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); padding: 40px; width: 100%; max-width: 400px; }
        .login-title { font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 8px; color: #1e40af; }
        .login-subtitle { text-align: center; color: #6b7280; margin-bottom: 32px; }
        .input-group { margin-bottom: 20px; }
        .input-label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #374151; }
        .input-field { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; }
        .input-field:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .error-box { background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 12px; color: #dc2626; font-size: 14px; margin-bottom: 16px; }
        .success-box { background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 12px; color: #16a34a; font-size: 14px; margin: 12px 24px 0; }
        .info-box { background: #f9fafb; border-radius: 8px; padding: 16px; margin-top: 24px; }
        .main-container { display: flex; flex-direction: column; height: 100vh; }
        .header { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
        .header-title { display: flex; align-items: center; gap: 12px; font-size: 18px; font-weight: bold; }
        .header-actions { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
        .btn-small { padding: 8px 16px; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s; }
        .btn-green { background: #16a34a; color: white; }
        .btn-green:hover { background: #15803d; }
        .btn-purple { background: #9333ea; color: white; }
        .btn-purple:hover { background: #7e22ce; }
        .btn-gray { background: #6b7280; color: white; }
        .btn-gray:hover { background: #4b5563; }
        .map-container { flex: 1; position: relative; }
        #map { width: 100%; height: 100%; }
        .legend { position: absolute; top: 16px; left: 16px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 16px; max-width: 250px; z-index: 100; }
        .legend-title { font-weight: bold; margin-bottom: 12px; font-size: 14px; }
        .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 13px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        .legend-stats { margin-top: 12px; padding-top: 12px; border-top: 1px solid #e5e7eb; font-size: 12px; color: #6b7280; }
        .detail-panel { position: absolute; top: 16px; right: 16px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 20px; width: 340px; max-height: 80vh; overflow-y: auto; z-index: 100; }
        .detail-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; }
        .detail-title { font-weight: bold; font-size: 16px; }
        .detail-subtitle { font-size: 12px; color: #6b7280; margin-top: 4px; }
        .close-btn { background: none; border: none; cursor: pointer; color: #9ca3af; font-size: 20px; padding: 0; width: 24px; height: 24px; }
        .close-btn:hover { color: #4b5563; }
        .detail-section { margin-bottom: 12px; font-size: 13px; }
        .detail-label { color: #6b7280; margin-bottom: 4px; font-size: 12px; }
        .detail-value { font-weight: 500; }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn-navi { width: 100%; background: #facc15; color: #1f2937; margin-top: 16px; }
        .btn-navi:hover { background: #eab308; }
        select { padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div style="text-align: center; margin-bottom: 24px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                </svg>
            </div>
            <h1 class="login-title">í˜‘íšŒ íšŒì›ì‚¬ ê´€ë¦¬</h1>
            <p class="login-subtitle">ì„ì§ì› ì „ìš© ì‹œìŠ¤í…œ</p>
            <div id="errorMsg" class="error-box hidden"></div>
            <div class="input-group">
                <label class="input-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="passwordInput" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <button onclick="login()" class="btn btn-primary"><span>ğŸ”‘</span> ë¡œê·¸ì¸</button>
            <div class="info-box"><p style="font-size: 13px; color: #6b7280;"><strong>ë°ëª¨ ë¹„ë°€ë²ˆí˜¸:</strong> admin1234</p></div>
        </div>
    </div>

    <div id="mainScreen" class="main-container hidden">
        <header class="header">
            <div class="header-title">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                <span>í˜‘íšŒ íšŒì›ì‚¬ ì§€ë„ ê´€ë¦¬</span>
            </div>
            <div class="header-actions">
                <div style="display: flex; align-items: center; gap: 8px;"><span style="font-size: 14px;">ğŸ“</span><select id="regionFilter" onchange="filterByRegion()"><option value="ì „ì²´">ì „ì²´</option></select></div>
                <button onclick="loadSample()" class="btn-small btn-purple">ìƒ˜í”Œ</button>
                <label class="btn-small btn-green" style="cursor: pointer;"><span>ğŸ“¤</span> ì—…ë¡œë“œ<input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleFile(event)"></label>
                <button onclick="logout()" class="btn-small btn-gray"><span>ğŸšª</span> ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </header>
        <div id="successMsg" class="success-box hidden"></div>
        <div class="map-container">
            <div id="map"></div>
            <div class="legend">
                <div class="legend-title">ë²”ë¡€</div>
                <div class="legend-item"><div class="legend-dot" style="background: #4CAF50;"></div><span>2026ë…„ ë‚©ë¶€ì™„ë£Œ</span></div>
                <div class="legend-item"><div class="legend-dot" style="background: #FFC107;"></div><span>2025ë…„ ë‚©ë¶€ì™„ë£Œ</span></div>
                <div class="legend-item"><div class="legend-dot" style="background: #FF4444;"></div><span>2025ë…„ ë¯¸ë‚©</span></div>
                <div class="legend-stats"><div>ì§€ì—­: <strong id="currentRegion">ì „ì²´</strong></div><div>í‘œì‹œ: <strong id="displayCount">0</strong>ê°œ</div><div>ì „ì²´: <strong id="totalCount">0</strong>ê°œ</div></div>
            </div>
            <div id="detailPanel" class="detail-panel hidden"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        let map, markers = [], allMembers = [], filteredMembers = [], geocoder, kakaoReady = false;
        const sampleData = [
            { ê³ ê°ë²ˆí˜¸: 'C001', íšŒì‚¬ëª…: 'ìš¸ì‚°ì œì¡°(ì£¼)', ì—…ì¢…: 'ì œì¡°ì—…', ì—…íƒœ: 'ì² ê°•', íšŒì‚¬ì£¼ì†Œ: 'ìš¸ì‚°ê´‘ì—­ì‹œ ë‚¨êµ¬ ì‚¼ì‚°ë¡œ 100', ë¶€ì„œëª…: 'ì˜ì—…ë¶€', ì§ìœ„: 'ê³¼ì¥', ì „í™”ë²ˆí˜¸: '010-1234-5678', ì§€ì—­ë³¸ë¶€: 'ìš¸ì‚°', íšŒë¹„ê¸ˆì•¡: '100,000', '2024': 'Y', '2025': 'Y', '2026': 'Y', ë‚©ë¶€ì›”: '1ì›”' },
            { ê³ ê°ë²ˆí˜¸: 'C002', íšŒì‚¬ëª…: 'ë™í•´ì‚°ì—…', ì—…ì¢…: 'ì œì¡°ì—…', ì—…íƒœ: 'í™”í•™', íšŒì‚¬ì£¼ì†Œ: 'ìš¸ì‚°ê´‘ì—­ì‹œ ë™êµ¬ ë°©ì–´ì§„ìˆœí™˜ë„ë¡œ 1000', ë¶€ì„œëª…: 'ì´ë¬´ë¶€', ì§ìœ„: 'ëŒ€ë¦¬', ì „í™”ë²ˆí˜¸: '010-2345-6789', ì§€ì—­ë³¸ë¶€: 'ìš¸ì‚°', íšŒë¹„ê¸ˆì•¡: '150,000', '2024': 'Y', '2025': 'Y', '2026': 'N', ë‚©ë¶€ì›”: '3ì›”' }
        ];

        function initKakao(callback) {
            if (kakaoReady) return callback();
            const script = document.createElement('script');
            script.src = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=3dfec56e257ead2978bc60033728bf38&libraries=services&autoload=false';
            script.onload = () => {
                kakao.maps.load(() => {
                    map = new kakao.maps.Map(document.getElementById('map'), { center: new kakao.maps.LatLng(36.5, 127.5), level: 13 });
                    geocoder = new kakao.maps.services.Geocoder();
                    kakaoReady = true;
                    callback();
                });
            };
            document.head.appendChild(script);
        }

        function login() {
            if (document.getElementById('passwordInput').value === 'admin1234') {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainScreen').classList.remove('hidden');
                initKakao(() => {});
            } else showError('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }

        function logout() {
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('passwordInput').value = '';
        }

        function showError(msg) {
            const box = document.getElementById('errorMsg');
            box.textContent = msg; box.classList.remove('hidden');
            setTimeout(() => box.classList.add('hidden'), 3000);
        }

        function showSuccess(msg) {
            const box = document.getElementById('successMsg');
            box.textContent = msg; box.classList.remove('hidden');
            setTimeout(() => box.classList.add('hidden'), 3000);
        }

        function loadSample() {
            allMembers = filteredMembers = sampleData;
            updateRegionFilter(); displayMarkers(); updateStats();
            showSuccess('âœ“ ìƒ˜í”Œ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const data = new Uint8Array(ev.target.result);
                    const wb = XLSX.read(data, { type: 'array' });
                    const jsonData = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                    if (jsonData.length === 0) return showError('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    allMembers = filteredMembers = jsonData;
                    updateRegionFilter(); displayMarkers(); updateStats();
                    showSuccess(`âœ“ ${jsonData.length}ê°œ ë°ì´í„° ì—…ë¡œë“œ ì™„ë£Œ!`);
                } catch { showError('ì—‘ì…€ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'); }
            };
            reader.readAsArrayBuffer(file);
            e.target.value = '';
        }

        function updateRegionFilter() {
            const regions = ['ì „ì²´', ...new Set(allMembers.map(m => m.ì§€ì—­ë³¸ë¶€).filter(r => r))];
            document.getElementById('regionFilter').innerHTML = regions.map(r => `<option value="${r}">${r}</option>`).join('');
        }

        function filterByRegion() {
            const region = document.getElementById('regionFilter').value;
            filteredMembers = region === 'ì „ì²´' ? allMembers : allMembers.filter(m => m.ì§€ì—­ë³¸ë¶€ === region);
            displayMarkers(); updateStats();
            document.getElementById('currentRegion').textContent = region;
        }

        function displayMarkers() {
            if (!kakaoReady) return initKakao(displayMarkers);
            markers.forEach(m => m.setMap(null));
            markers = [];
            document.getElementById('detailPanel').classList.add('hidden');
            let firstCoords = null;

            filteredMembers.forEach(member => {
                const addr = member.íšŒì‚¬ì£¼ì†Œ || member.ì£¼ì†Œ;
                if (!addr) return;
                geocoder.addressSearch(addr, (result, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                        let color = member['2026'] === 'Y' ? '#4CAF50' : member['2025'] === 'Y' ? '#FFC107' : '#FF4444';
                        const markerImage = new kakao.maps.MarkerImage(
                            `data:image/svg+xml;base64,${btoa(`<svg xmlns="http://www.w3.org/2000/svg" width="30" height="40"><path fill="${color}" stroke="#fff" stroke-width="2" d="M15 0C8.373 0 3 5.373 3 12c0 8.25 12 28 12 28s12-19.75 12-28c0-6.627-5.373-12-12-12z"/><circle cx="15" cy="12" r="5" fill="#fff"/></svg>`)}`,
                            new kakao.maps.Size(30, 40), { offset: new kakao.maps.Point(15, 40) }
                        );
                        const marker = new kakao.maps.Marker({ map, position: coords, image: markerImage, title: member.íšŒì‚¬ëª… });
                        kakao.maps.event.addListener(marker, 'click', () => { showDetail(member); map.panTo(coords); });
                        markers.push(marker);
                        if (!firstCoords) { firstCoords = coords; map.setCenter(coords); map.setLevel(8); }
                    }
                });
            });
        }

        function showDetail(m) {
            const panel = document.getElementById('detailPanel');
            const statusText = m['2026'] === 'Y' ? '2026ë…„ ë‚©ë¶€ì™„ë£Œ' : m['2025'] === 'Y' ? '2025ë…„ ë‚©ë¶€ì™„ë£Œ' : '2025ë…„ ë¯¸ë‚©';
            const statusColor = m['2026'] === 'Y' ? '#16a34a' : m['2025'] === 'Y' ? '#ca8a04' : '#dc2626';
            panel.innerHTML = `<div class="detail-header"><div><div class="detail-title">${m.íšŒì‚¬ëª…}</div>${m.ê³ ê°ë²ˆí˜¸ ? `<div class="detail-subtitle">ê³ ê°ë²ˆí˜¸: ${m.ê³ ê°ë²ˆí˜¸}</div>` : ''}</div><button class="close-btn" onclick="document.getElementById('detailPanel').classList.add('hidden')">Ã—</button></div>${m.íšŒì‚¬ì£¼ì†Œ ? `<div class="detail-section" style="padding-bottom:12px;border-bottom:1px solid #e5e7eb"><div class="detail-label">ì£¼ì†Œ</div><div class="detail-value" style="font-size:12px">${m.íšŒì‚¬ì£¼ì†Œ}</div></div>` : ''}<div class="detail-grid">${m.ì—…ì¢… ? `<div class="detail-section"><div class="detail-label">ì—…ì¢…</div><div class="detail-value">${m.ì—…ì¢…}</div></div>` : ''}${m.ì—…íƒœ ? `<div class="detail-section"><div class="detail-label">ì—…íƒœ</div><div class="detail-value">${m.ì—…íƒœ}</div></div>` : ''}</div><div style="padding-top:12px;border-top:1px solid #e5e7eb"><div class="detail-label">í˜„ì¬ ìƒíƒœ</div><div style="font-weight:bold;color:${statusColor}">${statusText}</div></div><button class="btn btn-small btn-navi" onclick="openNavi('${m.íšŒì‚¬ì£¼ì†Œ}')">ğŸ§­ ì¹´ì¹´ì˜¤ë‚´ë¹„</button>`;
            panel.classList.remove('hidden');
        }

        function openNavi(addr) { window.open(`kakaomap://route?ep=${encodeURIComponent(addr)}&by=CAR`, '_blank'); }
        function updateStats() {
            document.getElementById('displayCount').textContent = filteredMembers.length;
            document.getElementById('totalCount').textContent = allMembers.length;
        }
        document.getElementById('passwordInput').addEventListener('keypress', e => { if (e.key === 'Enter') login(); });
    </script>
</body>
</html>
